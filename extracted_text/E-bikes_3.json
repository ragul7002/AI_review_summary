{
  "abstract": "Bike Sharing Systems (BSSs) play a crucial role in promoting sustainable urban mobility by facilitating short-range trips and connecting with other transport modes. Traditionally, most BSS fleets have consisted of mechanical bikes (m-bikes), but electric bikes (e-bikes) are being progressively introduced due to their ability to cover longer distances and appeal to a wider range of users. However, the charging requirements of e-bikes often hinder their deployment and optimal functioning. This study examines the spatiotemporal variations in battery levels of Barcelona’s BSS, revealing that bikes stationed near the city centre tend to have shorter rest periods and lower average battery levels. Additionally, to improve the management of e- bike fleets, a Markov-chain approach is developed to predict both bike availability and battery levels. This research offers a unique perspective on the dynamics of e-bike battery levels and provides a practical tool to overcome the main operational challenges in their implementation.",
  "introduction": "By 2022, more than 2,000 Bike Sharing Systems (BSSs) were available worldwide, with approximately 9 million bikes in circulation [33]. These systems enhance the efficiency of public transport by improving access to stations [35, 25], which in turn reduces car usage and alleviates traffic congestion [32, 18]. Moreover, the increased use of bikes and the resulting shift in transport modes have been shown to positively impact public health by promoting physical activity [37], benefit the environment by reducing pollutant emissions [13], and lead to economic savings [39]. \nThe recent increase in data availability related to BSSs has led to greater interest in understanding the mobility patterns within these systems [28, 29]. Studies have shown that stations with strong flows tend to be located nearby [11], and they often display a certain level of mesoscopic organisation within communities [53]. Additionally, the development of models to understand the usage of micro-mobility [46] has improved understanding of factors such as topography [26], day of the week [46], weather conditions [16, 27, 5], and the built environment [46]. Furthermore, efforts have been made to develop predictive models that enhance the management of BSSs infrastructures \n1 \nefficiently and guide system expansion through machine learning and probabilistic approaches [42, 30, 10, 3, 51, 4]. In this line, one of the major challenges in optimising BSS performance is ensuring bike availability, as stations often experience significant flow imbalances [52, 43, 17]. To address this, models focused on optimising rebalancing operations have been developed [38, 14, 15, 12]. \nIn recent years, BSSs have undergone progressive electrification [33, 20], with a sharp increase in the number of e-bikes compared to their mechanical counterparts [20, 7], as e-bikes allow for longer trips and attract a broader user base [41, 49]. E-bikes have been shown to be less sensitive to factors such as longer distances, adverse weather conditions, and casualties [48, 9, 40]. Despite these advantages, e-bikes present additional challenges to maintaining bike availability, primarily due to low battery levels, battery malfunctions, and complications arising from high temperatures [24, 19, 54, 47]. Moreover, the scarcity of battery data at the system level complicates the development of predictive models. While several studies have implemented frameworks to predict the battery consumption of individual bikes during trips [8, 45], most approaches at the BSS level focus on the station-level granularity [55]. \nThis publication addresses the challenge that the state of charge poses to e-bike availability by analysing mobility and battery level data from Barcelona’s BSS (Bicing) and proposing a model that predicts future bike locations with their corresponding battery levels. The structure of the paper is as follows: first, the spatial and temporal variability in average battery levels is analysed to identify regions more vulnerable to battery depletion. Next, a Markov chain approach is implemented to predict the future locations of bikes. Subsequently, the parameters in the equations describing battery power consumption are optimised. Finally, by combining the models presented in the two previous sections, a framework is provided to support the management of e-bike fleets by projecting future scenarios.",
  "results": "## **Assessing e-bikes’ battery levels and usage patterns** \nThis research analyses the bike usage and battery levels of Barcelona’s BSS [44, 50, 22], using data supplied by its operator, Bicing, which includes trip and battery information: \n- The mobility data spans between April 2019 and December 2022, comprising 53 million trips, of which 62% were performed with m-bikes and 38% with e-bikes. Each trip record includes the station of origin and destination, the start and end date of the trip, a bike identifier, the bike model (m-bike or e-bike), and an anonymised user identifier [22]. In this work, we focus specifically on the mobility of e-bikes. \n- To analyse e-bike battery consumption, two datasets were used: one with snapshots taken every 8 hours over the entire year of 2022, and another with snapshots taken every 30 minutes over three weeks from 29 March to 18 April 2023 (Figures S1 and 3 ). The relevant fields in both datasets include percentage, voltage, current, and temperature of the battery, bike station, timestamp, bike status (operative, low battery, or inoperative for several reasons such as maintenance), and location (at station, in use, or at the workshop). A detailed analysis of these datasets is provided in Sections S1 and S2. \nAdditionally, trip data from March and April 2023 was available to assess battery consumption in the 30-minute dataset. \n2 \n**==> picture [386 x 301] intentionally omitted <==**\nFigure 1: **Analysis of average battery levels and temporal clustering** . **a.** Average battery levels across neighbourhoods. The average for each neighbourhood is computed using the battery values of all the bikes in that neighbourhood. **b.** Clustering of the neighbourhoods according to the temporal pattern of battery levels using K-means into four distinct clusters. **c.** Temporal series of average battery levels for each cluster. The neighbourhoods in grey do not have bike-sharing stations. \n3 \nThe average battery levels per neighbourhood show significant variability across neighbourhoods (Figure 1a, Figure S3). To facilitate the analysis of all the temporal series of average battery levels derived from each neighbourhood, K-means clustering was performed, resulting in four distinct clusters (Figure 1b, Figure S4). The central and southern neighbourhoods, which fall into Clusters 1 and 4, have the lowest battery levels, exhibiting steep declines in battery levels during business hours with recovery during nighttime (Figure 1c). This is likely due to the high levels of industrial and commercial activity, as well as the dense populations in these areas. Additionally, it is worth noting that some neighbourhoods in Cluster 4 have slower charging speeds at night, likely due to a stronger nightlife presence. In contrast, northern neighbourhoods in Clusters 2 and 3 are mainly residential with less commercial activity, resulting in higher and more stable battery levels throughout the day. \nApart from the inter-event time, two additional factors can affect the average battery levels at a station: the origins of the trips that the station receives and the number of trips coming from each origin. Trips originating from farther stations tend to deplete the battery more. Therefore, stations that receive a greater number of trips from distant origins will typically have lower average battery levels compared to those receiving trips from nearby stations. To quantify the impact of trip distances on battery levels, a distance index ( _DIj_ ) was calculated for each station _j_ . This index accounts for both the distance of each trip and the frequency of trips from each origin station. Specifically, the distance of each trip ( _di,j_ ) from station _i_ to station _j_ is weighted by the inverse of the number of trips from station _i_ ( _ni_ ). These weighted distances are then summed for each destination station _j_ and normalised by the total number of trips received by station _j_ ([�] _i[T][ij]_[) to] account for the overall activity level at the station: \n**==> picture [247 x 30] intentionally omitted <==**\n4 \n**==> picture [386 x 325] intentionally omitted <==**\n## **Modelling e-bike battery levels** \nTo model the battery levels of bikes, a linear increasing term was applied when docked, and a linear decreasing term during trips. The main variables available to compute battery consumption \n6 \n9 \n**==> picture [365 x 176] intentionally omitted <==**\n**----- Start of picture text -----**<br>\na b<br>0.8<br>0.7<br>0.6<br>0.5<br>0.4<br>0.3<br>0.2<br>0.1<br>0.0<br>30 60 90 120 150 180 30 60 90 120 150 180<br>t (min) t (min)<br>p<br>r<br>**----- End of picture text -----**<br>\nFigure 6: **Correlations for the Markov chain model over various time horizons. a.** Pearson correlation coefficient between actual and predicted bike availability per station as a function of ∆ _t_ . **b.** Pearson correlation coefficient between actual and predicted average battery level per station as a function of ∆ _t_ . \n**==> picture [380 x 140] intentionally omitted <==**\n**----- Start of picture text -----**<br>\na b pj: 0.050<br>pj: 0.010<br>100<br>90<br>80<br>70<br>)(%<br>le<br>v<br>le<br>ttreay<br>B<br>**----- End of picture text -----**<br>\nFigure 7: **Bike location and average battery level predicted with the Markov model.** Probability of finding a bike and average battery levels after **a.** 30 and **b.** 120 minutes for trips starting from the Glòries station (St. Ciutat de Granada, 168) starting at 08:00. The origin station is highlighted with a triangle. \n10 \nlevels are observed in the afternoon due to increased battery consumption throughout the day. \n**==> picture [376 x 146] intentionally omitted <==**\n**----- Start of picture text -----**<br>\na b 20 bikes<br>10 bikes<br>5 bikes<br>2 bikes<br>95<br>90<br>85<br>)(%<br>le<br>v<br>le<br>ttreay<br>b<br>e<br>g<br>are<br>v<br>A<br>**----- End of picture text -----**<br>\nFigure 8: **Bike availability and battery levels predictions at the BSS level after 120 minutes, using the Markov chain approach combined with the battery equations.** Prediction of available bikes and their average battery levels after 120 minutes of simulation, starting at **a.** 08:00 and **b.** 18:00. \n## **Limitations** \nThe main constraints of this study are the limited amount of data and the lack of detailed trip information. The first dataset has an 8-hour resolution, which complicates accurate model training and evaluation. Although the second dataset offers a 30-minute resolution, it is limited to two weeks and does not include bikes in transit. In addition to the battery data, the incomplete trip data further complicates model development. Information on the exact routes taken by users is unavailable, making it difficult to estimate battery consumption for round trips. Additionally, details such as the bike’s condition (e.g., tyre inflation) or relevant rider characteristics (e.g., weight or height) are also missing.",
  "methods": "5 \nincoming trips, leading to lower battery levels. Zona Franca, as previously mentioned, deviates from this trend due to its unique industrial nature and low population density. The Pearson correlation between the distance index and average battery levels at the station level revealed a value of 0.47 (Figure 2d), indicating a moderate positive correlation. This suggests that stations farther from others and receiving a lower number of trips tend to have higher average battery levels. Additionally, no significant collinearities were found between the inter-event time and the distance index (Figure S5 and Table S1). \n## **Predicting e-bike locations with a Markov chain-based approach** \nTo predict bike locations, a probabilistic model based on a Markov chain approach has been developed [31, 23]. In this model, each bicycle of the system is modelled independently, with transitions based on the probability of movement from its current station. Given a starting location for a bike and a forecasting horizon ∆ _t_ , the algorithm follows the sequence below: \n- An inter-event time is sampled from the distribution _Ii[w,h]_ to simulate the resting time of a bike given a station _i_ on a specific day type _w_ and hour _h_ . The days of the week are grouped into four categories: Working days (Monday to Thursday), Friday, Saturday, and Sunday. The distribution _Ii[w,h]_ is calculated by determining the time elapsed between a bike’s arrival at station _i_ and its next departure. \n- If the inter-event time exceeds the desired ∆ _t_ , the process stops, and the final location of the bike will correspond to its current station. \n- If the forecasting horizon is greater than the inter-event time, a destination _j_ is sampled based on the probability _Mij[w,h]_ , given a weekday _w_ , hour _h_ , and origin station _i_ . This destination then becomes the new location of the bike, and the average travel time between the station pairs, _τij_ , is elapsed. The destination probability is calculated using the number of trips _Tij[w,h]_ between _i_ and _j_ from the 2022 trip data, as follows: \n**==> picture [245 x 31] intentionally omitted <==**\n- If the total time elapsed after completing the trip exceeds the desired ∆ _t_ , the final predicted location will be station _j_ . Otherwise, the process starts again. \nThe fit between the observed and expected battery levels, using the optimal parameters, is shown in Figure 3. In Figure 3a, the predicted battery percentage is displayed, while in Figure 3b, the predicted battery variation is presented. Despite the dispersion, a significant correlation is observed, with values closely aligned to the diagonal. Factors such as user heterogeneity, missing route information, or bikes not charging while docked could contribute to the dispersion. The parameters were also validated using the 8-hour dataset, with similar correlation values, as shown in Figure S6 (Section S3). \n**==> picture [386 x 173] intentionally omitted <==**\nFigure 3: **Battery model predictions for the validation set of the 30-minute dataset. a.** Observed battery level as a function of the predicted values. **b.** Battery variation observed as a function of the predicted values. Each point corresponds to one battery-level observation. The Root Mean Squared Error (RMSE) is 0 _._ 0178 and the Pearson correlation coefficient is significant (p-value<0.001) in both cases. The linear fit is shown in grey. \nThis battery model can have two key applications. The first enables the assessment of battery consumption and destination probabilities for individual trips. The second integrates the Markov chain-based approach with the battery model to predict both e-bike locations and battery levels across the entire fleet. \n## **Single trip application** \nEvaluating short-term scenarios for a single bike can be achieved by coupling the battery model with the distribution of possible destinations _Pij[w,h]_ . In Figure 4, given _St. Ciutat de Granada, 168_ as the origin station, the probability of arriving at each destination is represented by the size of the dots, while the battery consumption for each bike trip is indicated by the colour. The probability \n7 \nof destinations changes significantly between 8:00 and 18:00 despite the same origin station. At 18:00, trips tend to be shorter and head towards nearby stations, while morning trips are longer and converge towards a few work-related hot spots. Additionally, battery consumption varies notably based on the elevation changes along the route, with trips going downhill consuming less battery over the same distance. The altitude of each station is provided in Figure S7 [34]. \n**==> picture [355 x 114] intentionally omitted <==**\n**----- Start of picture text -----**<br>\nSingle trip consumption Weekday 08:00 Single trip consumption Weekday 18:00<br>a c/ ciutat de granada, 168 b c/ ciutat de granada, 168<br>pj: 0.050 pj: 0.050<br>pj: 0.010 pj: 0.010<br>20 20<br>Origin Origin<br>10 10<br>)(% )(%<br>n n<br>itop itop<br>m m<br>usn usn<br>oc oc<br>ttreay ttreay<br>B B<br>**----- End of picture text -----**<br>\nFigure 4: **Single trip location and battery prediction** . Probability of finding a bike at a station and battery consumption of the trip when departing from the _St. Ciutat de Granada, 168_ station on a weekday at **a.** 08:00 and **b.** 18:00. The origin station is highlighted with a triangle. The size of the dots corresponds to the probability of having that station as the destination and color corresponds to the battery consumed by the bike. The grey points correspond to destination stations with no trips. \nFurthermore, an impact index can be computed to assess the influence of each origin station on battery levels. This index depends on the probability of each destination given an origin station, the battery consumption of each possible trip, and the average hourly trips departing from station _i_ to other stations. The impact index can be written as: \n**==> picture [268 x 15] intentionally omitted <==**\nwhere _⟨Ti[w,h] ⟩_ represents the average number of trips departing from station _i_ , _Pij[w,h]_ is the probability that a trip generated in station _i_ ends in station _j_ , and ∆ _Bij_ is the battery consumed by a trip from _i_ to _j_ . An example of the impact index _γ_ at 8:00 and 18:00 on a regular weekday is shown in Figure 5. Due to the variation in trip patterns captured by _Pij[w,h]_ , the stations with the highest impact change throughout the day. \n## **Coupling the Markov chain and the battery models** \nThe adjusted battery consumption function can be integrated into the Markov chain approach to provide joint predictions of both location and battery levels over multiple trips, either at the single-bike or BSS level. Inter-event times are used to calculate the charging percentage, while the distance and duration of trips are used to calculate energy consumption. To validate this approach, \n8 \n**==> picture [384 x 135] intentionally omitted <==**\n**----- Start of picture text -----**<br>\na b<br>2.5<br>2.0<br>1.5<br>i<br>1.0<br>0.5<br>**----- End of picture text -----**<br>\nFigure 5: **Impact index of the stations at different hours.** Impact index of the stations at **a.** 08:00 and **b.** 18:00. The station with higher impact at each hour is highlighted with a larger dot size. In the morning, the _St. Provença, 125_ station has the highest impact, while in the afternoon, _St. Ciutat de Granada, 168_ has the greatest impact. \nsystematic simulations were performed using the initial conditions from the 2023 mobility data and 30-minute battery data (Figure 6). This included the average number of available bikes and average battery levels per station. Simulations were performed across various initial scenarios and time horizons to demonstrate the capabilities of the coupled model. Additionally, to prevent data leakage, the probabilities of the Markov model were based on data from the year 2022. \nFirst, it is possible to compute the probability of finding a bike at a given destination and its battery level as a function of its origin, following one or more trips within a time period ∆ _t_ . The final battery levels are determined by averaging over all the Markov iterations. As an example, Figure 7 shows the probability and battery levels of bikes departing from the station at Glòries ( _St. Ciutat de Granada, 168_ ) at 08:00 after **a.** 30 and **b.** 120 minutes. The role of distance from the origin is evident in the short-term predictions, with lower battery levels at greater distances and inclinations. However, this effect diminishes over longer time windows, as multiple trips can occur before reaching a station. For longer periods, a greater variety of final destinations is also possible. \n11 \nmicro-mobility services. Although some challenges remain due to the lack of on-route data, such as speed or location, the battery function has been validated. This function, when combined with a Markov chain approach, provides a validated prediction for the availability of e-bikes, either due to an imbalance between stations, or to an overused battery. Further improvements could be made, particularly if more detailed data were available. Access to GPS information on the routes taken would likely improve power consumption estimates, while higher-resolution data could enhance battery predictions through machine learning approaches. \nWith the progressive electrification of bike fleets worldwide, predictions of availability alone may be insufficient, as docked bikes with low batteries remain unusable. The presented approach opens the door to developing microscopic models that provide joint predictions of bike availability and battery levels. This framework could support BSS providers in optimising bike availability and identifying stations at higher risk of disrupting urban mobility. \n## **Mathematical formulation of the battery consumption** \nThe gravity resistance _Fg_ is given by: \n**==> picture [274 x 12] intentionally omitted <==**\nwhere _g_ is the gravitational acceleration, _m_ is the combined mass of the rider and bike, and _s_ represents the slope. Similarly to [8], _Fg_ = 0 when _Fg ≤_ 0. \nRolling resistance _Fr_ is given by: \n**==> picture [286 x 12] intentionally omitted <==**\nwhere _Crr_ is the rolling resistance coefficient. Finally, the aerodynamic drag _Fa_ is given by: \n**==> picture [281 x 13] intentionally omitted <==**\nwhere _Cd_ denotes the drag coefficient, _A_ is the frontal area, _ρ_ is the air density, and _v_ and _w_ are the bike and wind speeds, respectively. The instantaneous power consumed is then given by: \n**==> picture [239 x 11] intentionally omitted <==**\nAssuming no energy losses during the process, the total power consumed over a trajectory of duration _t_ is given by _tv_ ( _Fg_ + _Fr_ + _Fa_ ). As the instantaneous speed information is unavailable, the speed is approximated by dividing the total distance travelled by the trip time. Consequently, the energy consumed in a trip is given by _dij_ ( _Fg_ + _Fr_ + _Fa_ ), where the distance travelled is approximated using the OpenRouteService API [21], which recommends bicycle routes based on OpenStreetMap data [36]. To convert power consumed into a battery percentage, and taking into account that \n12 \nthe e-bikes only provide support to the rider when pedalling, a constant _K_ trip has been added by multiplying the whole equation _K_ trip _dij_ ( _Fg_ + _Fr_ + _Fa_ ). \nOn the other hand, the rate of battery recharge during rest periods is modelled as: \n**==> picture [259 x 24] intentionally omitted <==**\nwhere _K_ rest represents the charging constant, and _t_ rest is the rest time. The inverse of _K_ rest corresponds to the time required to fully charge a bike from 0% to 100%. The division by 60 is included to express _K_ rest in units of _min[−]_[1] . All variables are represented in the International System of Units. \n## **Optimisation of the battery consumption function** \nThe battery consumption during a trip can be approximated by an expression that groups the relevant constants. This expression is written as: \nwhere \n**==> picture [358 x 12] intentionally omitted <==**\n**==> picture [88 x 41] intentionally omitted <==**\nAlthough the constant _K_ trip is not strictly required mathematically, it allows us to explore feasible values for _Ka_ , _Kb_ , _Kc_ . Apart from _g_ , the constants involved in the computation of _Ka_ , _Kb_ , and _Kc_ are unknown and may vary depending on factors such as rider characteristics, weather conditions, bike status, and terrain type. Therefore, an optimisation process is necessary to determine the optimal values of _Ka_ , _Kb_ , and _Kc_ that enable accurate battery consumption predictions, even when the constants of every trip are not known precisely. \nTo perform the optimisation, a different range of values is considered for each constant. The mass _m_ is assumed to range between 79 kg and 119 kg, considering the bike’s weight of 29 kg. Based on previous studies [45, 6], the rolling resistance coefficient can range between 0 _._ 001 and 0 _._ 003, the drag coefficient between 0 _._ 6 and 0 _._ 8, and the effective area between 0 _._ 4 and 0 _._ 6. The air density _ρ_ is fixed at 1 _._ 225 _kg/m_[3] , corresponding to a temperature of 15 _[◦] C_ at sea level. Given these constants’ value ranges, the following limits are defined for the hyper-parameter optimisation: _Ka_ = [774 _._ 2 _,_ 1166 _._ 2], _Kb_ = [0 _._ 7742 _,_ 3 _._ 4986], and _Kc_ = [0 _._ 147 _,_ 0 _._ 294]. The range for _K_ rest is set between [0 _._ 002083 _,_ 0 _._ 055], corresponding to charging times from 480 to 180 minutes, respectively. The range for _K_ trip is set between [1 _·_ 10 _[−]_[8] _,_ 1]. \nThe Optuna framework was utilised for hyper-parameter optimisation, using 75% of the threeweek 30-minute dataset for training and 25% for validation. The optimal values obtained were: \n13 \n**==> picture [77 x 71] intentionally omitted <==**\n## **Funding** \nThis work has been funded by CIDAI (Center for Innovation in Data Tech and Artificial Intelligence) through the Catalan Government’s CATALONIA.AI programme. J.G.E is a fellow of Eurecat’s “Vicente López” PhD grant program. \n## **Acknowledgements** \nWe thank Daniel Santanach, coordinator of CATALONIA.AI programme. We thank Marco Orellana from CIDAI (Centre of Innovation for Data Tech and Artificial Intelligence). We want to thank Faustino Corchero from Barcelona de Serveis Municipals and Roger Junqueras, Irene Giménez and all collaborators from Pedalem-Bicing. \n## **Author contributions statement** \n## **References** \n- [1] Ajuntament de Barcelona. _Population density of Barcelona neighborhoods_ . `https://ajuntament. barcelona.cat/estadistica/angles/Estadistiques_per_temes/Medi_urba/Territori/ Superficie/a2021/S0403.htm` . Accessed: 2024-09-09. 2021. \n- [2] Takuya Akiba et al. “Optuna: A next-generation hyperparameter optimization framework”. In: _Proceedings of the 25th ACM SIGKDD international conference on knowledge discovery & data mining_ . 2019, pp. 2623–2631. \n- [3] Vitória Albuquerque, Miguel Sales Dias, and Fernando Bacao. “Machine learning approaches to bike-sharing systems: A systematic literature review”. In: _ISPRS International Journal of Geo-Information_ 10.2 (2021), p. 62. \n- [4] Mohammed H Almannaa, Mohammed Elhenawy, and Hesham A Rakha. “Dynamic linear models to predict bike availability in a bike sharing system”. In: _International journal of sustainable transportation_ 14.3 (2020), pp. 232–242. \n14 \n- [5] Huthaifa I Ashqar, Mohammed Elhenawy, and Hesham A Rakha. “Modeling bike counts in a bike-sharing system considering the effect of weather conditions”. In: _Case studies on transport policy_ 7.2 (2019), pp. 261–268. \n- [6] William M Bertucci, Simon Rogier, and Raoul F Reiser. “Evaluation of aerodynamic and rolling resistances in mountain-bike field conditions”. In: _Journal of sports sciences_ 31.14 (2013), pp. 1606–1613. \n- [7] Tomasz Bieliński et al. “Lessons from implementing a metropolitan electric bike sharing system”. In: _Energies_ 13.23 (2020), p. 6240. \n- [8] Erik Burani, Giacomo Cabri, and Mauro Leoncini. “An algorithm to predict e-bike power consumption based on planned routes”. In: _Electronics_ 11.7 (2022), p. 1105. \n- [9] Andrew A Campbell et al. “Factors influencing the choice of shared bicycles and shared electric bikes in Beijing”. In: _Transportation research part C: emerging technologies_ 67 (2016), pp. 399–414. \n- [10] Longbiao Chen et al. “Dynamic cluster-based over-demand prediction in bike sharing systems”. In: _Proceedings of the 2016 ACM International Joint Conference on Pervasive and Ubiquitous Computing_ . 2016, pp. 841–852. \n- [11] Longbiao Chen et al. “Understanding bike trip patterns leveraging bike sharing system open data”. In: _Frontiers of computer science_ 11 (2017), pp. 38–48. \n- [12] Federico Chiariotti et al. “A dynamic approach to rebalancing bike-sharing systems”. In: _Sensors_ 18.2 (2018), p. 512. \n- [13] Raeven Lynn M Clockston and David Rojas-Rueda. “Health impacts of bike-sharing systems in the US”. In: _Environmental research_ 202 (2021), p. 111709. \n- [14] Mauro Dell’Amico et al. “The bike sharing rebalancing problem: Mathematical formulations and benchmark instances”. In: _Omega_ 45 (2014), pp. 7–19. \n- [15] Mauro Dell’Amico et al. “The bike sharing rebalancing problem with stochastic demands”. In: _Transportation research part B: methodological_ 118 (2018), pp. 362–380. \n- [16] Wafic El-Assi, Mohamed Salah Mahmoud, and Khandker Nurul Habib. “Effects of built environment and weather on bike sharing demand: a station level analysis of commercial bike sharing in Toronto”. In: _Transportation_ 44 (2017), pp. 589–613. url: `https://api. semanticscholar.org/CorpusID:133307286` . \n- [17] Ahmadreza Faghih-Imani et al. “An empirical analysis of bike sharing usage and rebalancing: Evidence from Barcelona and Seville”. In: _Transportation Research Part A: Policy and Practice_ 97 (2017), pp. 177–191. \n- [18] Yichun Fan and Siqi Zheng. “Dockless bike sharing alleviates road congestion by complementing subway travel: Evidence from Beijing”. In: _Cities_ 107 (2020), p. 102895. \n- [19] David Florez et al. “Development of a bike-sharing system based on pedal-assisted electric bicycles for bogota city”. In: _Electronics_ 7.11 (2018), p. 337. \n- [20] Nikolaos-Fivos Galatoulas, Konstantinos N Genikomsakis, and Christos S Ioakimidis. “Spatiotemporal trends of e-bike sharing system deployment: A review in Europe, North America and Asia”. In: _Sustainability_ 12.11 (2020), p. 4611. \n- [21] GIScience Research Group and HeiGIT. _openrouteservice_ . `https : / / openrouteservice . org/` . Accessed: 2024-08-20. 2023. \n15 \n- [22] Jordi Grau-Escolano, Aleix Bassolas, and Julian Vicens. “Cycling into the workshop: e-bike and m-bike mobility patterns for predictive maintenance in Barcelona’s bike-sharing system”. In: _EPJ Data Science_ 13.1 (2024), pp. 1–21. \n- [23] Wei Huang et al. “Predicting human mobility with activity changes”. In: _International Journal of Geographical Information Science_ 29.9 (2015), pp. 1569–1587. \n- [24] Shuguang Ji et al. “Electric bike sharing: simulation of user demand and system availability”. In: _Journal of Cleaner Production_ 85 (2014), pp. 250–257. \n- [25] Christian Kapuku et al. “Assessing and predicting mobility improvement of integrating bikesharing into multimodal public transport systems”. In: _Transportation research record_ 2675.11 (2021), pp. 204–213. \n- [26] Injung Kim and Konstantinos Pelechrinis. “The anatomy of the daily usage of bike sharing systems: elevation, distance and seasonality”. In: _ACM SIGKDD workshop on Urban Computing_ . 2020. \n- [27] Kyoungok Kim. “Investigation on the effects of weather and calendar events on bike-sharing according to the trip patterns of bike rentals of stations”. In: _Journal of Transport Geography_ 66 (2018), pp. 309–320. url: `https://api.semanticscholar.org/CorpusID:158630089` . \n- [28] Zhaoyu Kou and Hua Cai. “Understanding bike sharing travel patterns: An analysis of trip data from eight cities”. In: _Physica A: Statistical Mechanics and its Applications_ 515 (2019), pp. 785–797. \n- [29] Wenwen Li et al. “Understanding intra-urban human mobility through an exploratory spatiotemporal analysis of bike-sharing trajectories”. In: _International Journal of Geographical Information Science_ 34.12 (2020), pp. 2451–2474. \n- [30] Yexin Li et al. “Traffic prediction in a bike-sharing system”. In: _Proceedings of the 23rd SIGSPATIAL international conference on advances in geographic information systems_ . 2015, pp. 1–10. \n- [31] Xin Lu et al. “Approaching the limit of predictability in human mobility”. In: _Scientific reports_ 3.1 (2013), p. 2923. \n- [32] Xinwei Ma et al. “Bike-sharing systems’ impact on modal shift: A case study in Delft, the Netherlands”. In: _Journal of cleaner production_ 259 (2020), p. 120846. \n- [33] Meddin. _The Meddin Bike-sharing World Map_ . `https://bikesharingworldmap.com` . Accessed: 2024-06-30. \n- [34] A. Nisbet. _OpenTopoData_ . `https://github.com/ajnisbet/opentopodata` . Accessed: 202408-20. 2013. \n- [35] Robert B Noland, Michael J Smart, and Ziye Guo. “Bikesharing trip patterns in New York City: Associations with land use, subways, and bicycle lanes”. In: _International journal of sustainable transportation_ 13.9 (2019), pp. 664–674. \n- [36] OpenStreetMap contributors. _Planet dump retrieved from https://planet.osm.org_ . `https:// www.openstreetmap.org/` . Accessed: 2024-08-20. 2013. \n- [37] Isabel Otero, Mark J Nieuwenhuijsen, and David Rojas-Rueda. “Health impacts of bike sharing systems in Europe”. In: _Environment international_ 115 (2018), pp. 387–394. \n16 \n- [38] Tal Raviv, Michal Tzur, and Iris A Forma. “Static repositioning in a bike-sharing system: models and solution approaches”. In: _EURO Journal on Transportation and Logistics_ 2.3 (2013), pp. 187–229. \n- [39] Miriam Ricci. “Bike sharing: A review of evidence on impacts and processes of implementation and operation”. In: _Research in Transportation Business & Management_ 15 (2015), pp. 28–38. \n- [40] Maya Siman-Tov et al. “A look at electric bike casualties: Do they differ from the mechanical bicycle?” In: _Journal of Transport & Health_ 11 (2018), pp. 176–182. \n- [41] Özlem Simsekoglu and Christian A Klöckner. “The role of psychological and socio-demographical factors for electric bike use in Norway”. In: _International journal of sustainable transportation_ 13.5 (2019), pp. 315–323. \n- [42] Divya Singhvi et al. “Predicting bike usage for new york city’s bike sharing system”. In: _Workshops at the twenty-ninth AAAI conference on artificial intelligence_ . 2015. \n- [43] Adish Singla et al. “Incentivizing users for balancing bike sharing systems”. In: _Proceedings of the AAAI Conference on Artificial Intelligence_ 29.1 (2015). \n- [44] Francesc Soriguera, Víctor Casado, and Enrique Jiménez. “A simulation model for public bike-sharing systems”. In: _Transportation research procedia_ 33 (2018), pp. 139–146. \n- [45] Wynand J vdM Steyn and Janike Warnich. “Comparison of tyre rolling resistance for different mountain bike tyre diameters and surface conditions”. In: _South African Journal for Research in Sport, Physical Education and Recreation_ 36.2 (2014), pp. 179–193. \n- [46] Tien Dung Tran, Nicolas Ovtracht, and Bruno Faivre d’Arcier. “Modeling bike sharing system using built environment factors”. In: _Procedia Cirp_ 30 (2015), pp. 293–298. \n- [47] Muhammad Usama, Yongjun Shen, and Onaira Zahoor. “Towards an energy efficient solution for bike-sharing rebalancing problems: a battery electric vehicle scenario”. In: _Energies_ 12.13 (2019), p. 2503. \n- [48] John Wamburu et al. “Ride substitution using electric bike sharing: feasibility, cost, and carbon analysis”. In: _Proceedings of the ACM on Interactive, Mobile, Wearable and Ubiquitous Technologies_ 5.1 (2021), pp. 1–28. \n- [49] Jonathan Weinert, Chaktan Ma, and Christopher Cherry. “The transition to electric bikes in China: history and key reasons for rapid growth”. In: _Transportation_ 34 (2007), pp. 301–318. \n- [50] Julia Winslow and Oksana Mont. “Bicycle sharing: Sustainable value creation and institutionalisation strategies in Barcelona”. In: _Sustainability_ 11.3 (2019), p. 728. \n- [51] Yuanxuan Yang et al. “Using graph structural information about flows to enhance short-term demand prediction in bike-sharing systems”. In: _Computers, Environment and Urban Systems_ 83 (2020), p. 101521. \n- [52] Zidong Yang et al. “Mobility modeling and prediction in bike-sharing systems”. In: _Proceedings of the 14th annual international conference on mobile systems, applications, and services_ . 2016, pp. 165–178. \n- [53] Martin Zaltz Austwick et al. “The structure of spatial networks and communities in bicycle sharing systems”. In: _PloS one_ 8.9 (2013), e74685. \n- [54] Chaofeng Zhang et al. “Battery maintenance of pedelec sharing system: Big data based usage prediction and replenishment scheduling”. In: _IEEE Transactions on Network Science and Engineering_ 7.1 (2019), pp. 127–138. \n17 \n- [55] Yaoming Zhou et al. “Dynamic battery swapping and rebalancing strategies for e-bike sharing systems”. In: _Transportation Research Part B: Methodological_ 177 (2023), p. 102820. \n18 \n## **Supplementary Material** \n## **Spatiotemporal variability and prediction of e-bike battery levels in bike-sharing systems** \n## **1 Data description** \nThe first dataset we analysed comprises battery levels recorded every 8 hours, containing data on 2,748 bikes from July 20th to December 31st, 2022 (spanning 164 days). Battery levels are recorded exclusively when bikes are docked at stations, resulting in 1.48 million data points. The dataset fields are datetime in second granularity, bike identifier, station, status (operative or inoperative for various maintenance reasons), and battery metrics such as voltage, temperature, current, and battery level (from 0 to 1). After excluding records with missing values and filtering for those labelled as ‘operative’, the dataset was narrowed to 671,251 rows. Additionally, for the modelling phase, only data points with a subsequent data point for the same bike 8 hours later were utilised. The details are provided in Figure S1. \n**==> picture [408 x 170] intentionally omitted <==**\nFigure S1: **30-minute dataset description. a.** Distribution of data points per bike. **b.** Distribution of battery levels across the dataset. \nThe second dataset contains battery level snapshots taken every 30 minutes for 3,004 bikes, totalling 2.71 million data points from March 29th to April 18th, 2023 (spanning 20 days). Similarly, this dataset includes the same fields, with battery level information available only when bikes are docked. After data cleaning and selecting the bikes with an ‘operative’ status, 1.87 million data points remained. For analysis, only data points with a subsequent reading for the same bike 8 hours later were used. The details are provided in Figure S2. \n19 \n**==> picture [408 x 170] intentionally omitted <==**\nFigure S2: **8-hour dataset data description. a.** Distribution of data points per bike. **b.** Distribution of battery levels across the dataset. \n20 \n## **2 Data analysis** \n**Battery levels across time for each neighbourhood** \n**==> picture [408 x 553] intentionally omitted <==**\n**----- Start of picture text -----**<br>\n21<br>**----- End of picture text -----**<br>\nFigure S3: **Average battery levels across time for each neighbourhood.** The x-axis represents time for an average week, while the y-axis lists the neighbourhoods. \n## **Choice of number of clusters** \n**==> picture [386 x 139] intentionally omitted <==**\n## **Collinearity between inter-event time and distance index** \nTo ensure that there is no significant collinearity between the inter-event time and the distance index, we examined both the correlation matrix and the Variance Inflation Factor (VIF) for each variable in the regression model. \nFigure S5 illustrates the correlation values among average battery level, inter-event time, and distance index. The correlation between inter-event time and distance index is 0.77, indicating a moderate relationship. At first glance, this might suggest potential collinearity between these two variables. \n22 \n**==> picture [258 x 194] intentionally omitted <==**\nFigure S5: **Correlation matrix for battery level, inter-event time, and distance index.** \nHowever, to confirm whether this correlation leads to collinearity, we computed the VIF for each variable. The VIF quantifies how much the variance of a regression coefficient is inflated due to collinearity with other predictors. A VIF value greater than 10 typically indicates high collinearity. The table below summarises the VIF values for the variables: \n|Variable|VIF|\n|---|---|\n|constant|170.328236|\n|battery level|1.296030|\n|inter-event time|2.447021|\n|distance index|2.680041|\nTable S1: **Variance Inflation Factor (VIF) values for the variables in the regression model.** \nAs shown in Table S1, the VIF values for the inter-event time and the distance index are 2.447021 and 2.680041, respectively. These values are well below the threshold of 10, indicating that there is no significant collinearity between these variables. \nThus, considering both the correlation matrix and the VIF values, we conclude that the interevent time and the distance index can be used as independent predictors in the regression model without concerns of collinearity. \n## **3 Battery validation and elevation data** \nIn Figure S6, the correlation between the predicted and observed battery levels in the 8-hour dataset is shown. \n23 \n**==> picture [386 x 172] intentionally omitted <==**\nFigure S6: **Battery model fit in the 8-hour dataset. a.** Observed battery level as a function of the predicted values. **b.** Battery change observed as a function of the predicted values. The Root Mean Squared Error (RMSE) is 0 _._ 036. The linear fit between both is shown in grey. \nBattery consumption is highly impacted by the altitude difference between the origin and destination stations of a trip. The altitude of each station in the BSS of Barcelona is provided in Figure S7. A clear division between the station near the sea and those in the northern region is observed. In some cases, the disparity between stations is steep, with differences in altitude greater than 100 metres. \n24 \nFigure S7: **Station altitude.** Altitude of the Bicing stations. \n**==> picture [49 x 154] intentionally omitted <==**\n**----- Start of picture text -----**<br>\n160<br>140<br>120<br>100<br>80<br>60<br>40<br>20<br>0<br>)<br>m<br>(<br>n<br>o<br>i<br>t<br>a<br>v<br>e<br>l<br>E<br>**----- End of picture text -----**<br>\n25",
  "conclusion": "The analysis revealed spatiotemporal variations in e-bike battery levels, with lower levels observed in the evenings due to daily usage, compared to higher levels in the mornings. Northern neighbourhoods tended to show higher battery levels, likely due to lower usage and longer resting times. The inter-event times and distance to other stations significantly correlate with the station’s battery levels."
}